<html>
    <head>
        <title>Relying Party</title>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

         <script>
            $(document).ready(function(){
                
                $('.logged-in').fadeOut(function () {
					$('.logged-out').fadeIn();
					});
                
                gigya.accounts.getAccountInfo({callback:function (response) {
				if (response.errorCode == 0) {
					  $('#profile-name').text("Welcome back " + response.profile.firstName + "!");
					  $('.logged-out').fadeOut(function () {
							  $('.logged-in').fadeIn();
					  });
                }
                }});

                gigya.socialize.addEventHandlers({
		            onLogin: loginHandler,
				    onLogout: logoutHandler
	            });

            })

            var newNonce=Date.now();
            var authorizeEndpointLink="https://fidm.us1.gigya.com/oidc/op/v1.0/3_OpyagoDK701Lv3rCsHO3Pwsw8GU3Zr0T60XRNueQAiQkEMO-NEUT--9UnVfcub-m/authorize?client_id=3lLQEkRDIleQ_tsOy1diUbKH&response_type=code&redirect_uri=https%3A%2F%2Flearn-gigya.herokuapp.com%2FRelyingParty&scope=openid%20email%20profile&nonce=" + newNonce;

            function login(){
                window.location.href = authorizeEndpointLink;
            }

            function register(){
                window.location.href = authorizeEndpointLink;
            }

            function profile_update(){
                var params = {
                    screenSet: 'Default-ProfileUpdate',
                    startScreen: 'gigya-update-profile-screen'
                };
                gigya.accounts.showScreenSet(params);
            }

            function subscribe(){
                var params = {
                    screenSet: 'Default-LiteRegistration',
                    startScreen: 'gigya-subscribe-with-email-screen'
                };
                gigya.accounts.showScreenSet(params);
            }

            function logout(){
                gigya.accounts.logout();
            }

            function back(){
                window.location.href = "https://learn-gigya.herokuapp.com/"
            }
            
            function loginHandler(response){
                var profile = response['user']; 
		        $('#profile-name').text("Welcome " + profile.firstName + "!"); 
		        $('.logged-out').fadeOut(function () {
			    $('.logged-in').fadeIn(); });
            }

            function logoutHandler(){
                $('a#userFirstname').text('');
			    $('.logged-in').fadeOut(function () {
				$('.logged-out').fadeIn(); })
            }
        </script>
    </head>

    <body>
        <div class="topnav">
            <a class="active" href="#home">Application 1</a>
            <a href="#" class="logged-out" onclick="login()">Login</a>
            <a href="#" class="logged-out" onclick="register()">Register</a>
            <a href="#" class="logged-out" onclick="subscribe()">Subscribe</a>
            <a href="#" id="profile-nav" class="logged-in" onclick="profile_update()">Profile Update</a>
            <a href="#" id="profile-name" class="logged-in">User</a>
            <a href="#" class="logged-in" onclick="logout()">Logout</a>
            <a href="#" onclick="back()">Back</a>
        </div>
    </body>
</html>